# CommentRadar 実装プラン

YouTubeのコメント欄を分析し、動画に対する視聴者の感情（肯定/否定）を可視化するWebアプリケーション「CommentRadar」の実装計画です。

## 1. 概要
ユーザーがYouTube動画のURLを入力すると、その動画のコメントを取得・解析し、視聴者の反応傾向（肯定派・否定派）を可視化します。「いいね数」による重み付けや、投稿時間帯による傾向分析も行います。

## 2. 技術スタック
モダンで拡張性が高く、美しいUIを実現するための構成です。

- **Frontend Framework:** Next.js (App Router)
  - 高速な動作とAPI機能（Server Actions/API Routes）の統合のため採用。
- **Language:** TypeScript
- **Styling:** Tailwind CSS + Shadcn/UI (or Radix UI)
  - 「Premiun & Dynamic」なデザイン要件を満たすため、美しくカスタマイズ可能なコンポーネントライブラリを使用。
- **Charts/Visualization:** Recharts
  - Reactに最適化された、美しくインタラクティブなグラフ描画ライブラリ。
- **Backend/API:** Next.js API Routes (Server Actions)
  - YouTube Data APIからのデータ取得と、LLMへの分析リクエストを制御。
- **Sentiment Analysis (感情分析 - Core Engine):**
  - **LLM (Large Language Model):** OpenAI API (GPT-4o-mini) または Google Gemini API (Flash 1.5) を使用。
  - **Why:** 辞書ベースでは難しい「皮肉」「文脈」「ネットスラング」を正確に理解し、高精度なスコアリングを実現するため。
  - **Batch Processing:** APIコストとレイテンシを抑えるため、複数のコメントをまとめてバッチ処理で解析するアーキテクチャを採用。

## 3. 機能要件

### A. 分析機能
1.  **YouTubeデータ取得:**
    - 動画情報の取得（タイトル、サムネイル、投稿日時）。
    - コメントスレッドの取得（ページネーション対応、最大件数制限あり）。
    - 取得データ: コメント本文、いいね数、投稿日時、返信数。
2.  **高精度感情分析 (LLM Powered):**
    - 取得したコメントをLLMに送信し、以下の情報を構造化データ（JSON）として抽出。
      - **Sentiment Score:** -1.0 (完全否定) 〜 0.0 (中立) 〜 +1.0 (完全肯定) の数値。
      - **Emotion Tags:** 「怒り」「共感」「面白い」「応援」などの感情タグ付け。
      - **Is_Sarcasm:** 皮肉かどうかのフラグ（肯定的な言葉で批判している場合など）。
    - **重み付け:** `Final Score = LLM_Score * (1 + log(LikeCount))`
      - LLMが判定した純粋な感情スコアに、いいね数による社会的証明の重みを加味。
3.  **時間帯分析:**
    - 投稿日時を「時間帯（0:00-23:59）」に分類。

### B. 可視化機能 (Dashboard)
1.  **Sentiment Overview (肯定/否定分布):**
    - ドーナツチャート: ポジティブ / ネガティブ / ニュートラルの割合。
2.  **Time x Sentiment Scatter (時間帯別分布):**
    - 散布図 (Scatter Plot):
      - X軸: 投稿時間帯 (0時〜24時)
      - Y軸: 感情スコア (肯定 vs 否定)
      - バブルサイズ: いいね数（影響力の大きさ）
      - *インサイト:* 「深夜には否定的なコメントが多い」「朝は応援コメントが多い」などを発見可能に。
3.  **Timeline (時系列推移):**
    - 動画公開から現在までの感情トレンドの推移グラフ。

## 4. 実装ステップ

### Phase 1: プロジェクトセットアップ & UI構築
- Next.js プロジェクトのセットアップ。
- Tailwind CSS & デザインシステムの構築。
- 基本的なレイアウト（ヘッダー、検索バー、ダッシュボード枠）の実装。

### Phase 2: データ取得ロジック (YouTube API)
- YouTube URLからVideo IDを抽出するユーティリティ。
- YouTube Data API (`commentThreads`) を叩くAPI Routeの実装。
- モックデータを用いた開発環境の整備。

### Phase 3: LLM感情分析ロジックの実装
- OpenAI / Gemini API クライアントの実装。
- **Prompt Engineering:**
  - コメントリストをJSON配列で渡し、「各コメントのID、スコア、理由」を返却させる最適化されたプロンプトの作成。
- **コスト & パフォーマンス最適化:**
  - トークン節約のためのプロンプト圧縮。
  - 並列処理（`Promise.all`）での高速化。

### Phase 4: ダッシュボード & 可視化の実装
- Rechartsを用いた各グラフのコンポーネント化。
- データとUIの結合。
- ローディング状態やエラーハンドリング（API上限など）の実装。

### Phase 5: Polishing (洗練)
- アニメーション追加（Framer Motion等を検討）。
- レスポンシブ対応の調整。
- カラーパレットの調整（ダークモード対応）。

## 5. UIイメージ
- **ヒーローセクション:** 画面中央に美しくデザインされた「検索バー」。
- **ダッシュボード:**
  - ガラスモーフィズム (Glassmorphism) を採用したカードデザイン。
  - 鮮やかなグラデーションを用いたグラフ。
  - コメントリスト: 高評価かつ特徴的なコメント（最も肯定的/否定的）をピックアップ表示。

---

このプランで実装を開始してよろしいでしょうか？
承認いただければ、まずはプロジェクトのセットアップ（Phase 1）から開始します。
